---
title: "FinalProject"
author: "Ben Thompson & Cody Coppage"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
# Import Statements

library(dplyr)
install.packages("fuzzyjoin")
library(fuzzyjoin)
library(lubridate)




```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
# Importing Oregon Bee Atlas dataset

OBA_dataset <- read.csv("OBA_2018-2024.csv")

#OBA_dataset
```

```{r}
# Importing Storm dataframe from Excel

storm_dataset <- read.csv("storm_data.csv")

storm_dataset
```

```{r}
# Specifying columns to drop from storm events dataframe. These columns are not relevant for our analysis

storm_dataset_cols_to_drop <- c(
  "EVENT_ID", 
  "CZ_NAME_STR", 
  "BEGIN_TIME", 
  "MAGNITUDE", 
  "TOR_F_SCALE", 
  "DEATHS_DIRECT", 
  "INJURIES_DIRECT",
  "DAMAGE_PROPERTY_NUM", 
  "DAMAGE_CROPS_NUM",
  "STATE_ABBR",
  "CZ_TIMEZONE",
  "MAGNITUDE_TYPE",
  "EPISODE_ID",
  "CZ_TYPE",
  "CZ_FIPS",
  "WFO",
  "INJURIES_INDIRECT",
  "DEATHS_INDIRECT",
  "FLOOD_CAUSE",
  "TOR_LENGTH",
  "TOR_WIDTH",
  "BEGIN_RANGE",
  "BEGIN_AZIMUTH",
  "END_RANGE",
  "END_AZIMUTH",
  "END_LOCATION",
  "END_TIME"
  )
```

```{r}
# Dropping the useless columns from storm

storm_dataset <- storm_dataset[, !(names(storm_dataset) %in% storm_dataset_cols_to_drop)]
#storm_dataset
```

```{r}
# Make sure the date columns are date objects 

storm_dataset <- storm_dataset %>%
  mutate(BEGIN_DATE = mdy(BEGIN_DATE))
#storm_dataset

OBA_dataset <- OBA_dataset %>%
  mutate(verbatimEventDate = mdy(verbatimEventDate))
#OBA_dataset
```

```{r}
# Join Tables

joined_data <- fuzzy_left_join(OBA_dataset, storm_dataset,
  by = c(
    "county" = "COUNTY",                        
    "verbatimEventDate" = "BEGIN_DATE"             
  ),
  match_fun = list(`==`, function(bee_date, storm_date) {
    bee_date >= storm_date & bee_date <= storm_date + 30
    }
  )
)

joined_data
```

```{r}
# Count of each unique storm that occured before a bee capture instance
joined_data %>%
  count(EVENT_TYPE)
```


```{r}

```


```{r}
```


```{r}

```


```{r}
```

